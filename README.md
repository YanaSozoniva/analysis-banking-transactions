# Analysis_banking_transactions

## Описание:

Analysis_banking_transactions - это приложение на Python, предназначенное для анализа транзакций, которые находятся 
в Excel-файле. Приложение генерирует JSON-данные для веб-страниц, формирует Excel-отчеты, а также предоставлять другие сервисы.

## Установка:

Клонируйте репозиторий:

Для SSH:
```
git@github.com:YanaSozoniva/analysis-banking-transactions.git

```

## Разработанные функции и примеры работы с ними:
### Модуль utils
#### Функция get_greetings():
Функция печатает Приветствие — «Доброе утро» / «Добрый день» / «Добрый вечер» / «Доброй ночи» 
в зависимости от текущего времени

Вывод функции get_greetings()
>"Добрый вечер"

#### Функция export_data_from_xlsx
Функция считывание финансовых операций из указанного XLSX-файла в виде DataFrame

#### Функция filter_by_date_range
Фильтрует данные с начала месяца, на который выпадает входящая дата, по входящую дату 
(по умолчанию берется текущая дата) или фильтрует на указанное количество месяцев.
Имеет следующие входные параметры: 
- df - данные в формате DataFrame;
- date - дата, не обязательный параметр, по умолчанию будет браться текущая дата
- count_month - (по умолчанию равен 1), позволяет настроить фильтрацию либо с начала месяца от указанной даты, 
- либо за несколько последних месяцев от указанной даты

#### Функция get_card_information
Функция принимает данные в формате DataFrame и выводит информацию по каждой карте в виде списка:
- последние 4 цифры карты,
- общая сумма расходов, 
- кешбэк (1 рубль на каждые 100 рублей))

Вывод функции get_card_information(df):
>[{"last_digits": "5091", "total_spent": 645.78, "cashback": 6.46},
  {"last_digits": "7197", "total_spent": 1749.25, "cashback": 17.49},]

#### Функция get_top_transactions_by_amount
Функция принимает данные в формате DataFrame возвращает Топ-5 транзакций по сумме платежа в виде списка

Вывод функции get_top_transactions_by_amount(df):
>[
        {"date": "20.12.2021", "amount": 5000.0, "category": "Развлечения", "description": "sevs.eduerp.ru"},
        {"date": "08.09.2024", "amount": -1588.36, "category": "Госуслуги", "description": "Почта России"},
        {"date": "31.12.2021", "amount": -645.78, "category": "Такси", "description": "Яндекс Такси"},
        {"date": "21.12.2021", "amount": -160.89, "category": "Переводы",
            "description": "Перевод Кредитная карта. ТП 10.2 RUR"},
        {"date": "01.12.2021", "amount": 23.6, "category": "Переводы", "description": "Дмитрий Р."},
    ]

#### Функция get_currency_rates
Функция обращается к внешнему API для получения текущего курса валют, указанных в пользовательских настройках и 
выводит результат в виде списка

Вывод функции get_currency_rates():
>[{"currency": "USD", "rate": 90.88}, {"currency": "EUR", "rate": 100.12}]

#### Функция get_stocks
Функция обращается к внешнему API для получения стоимости акций, указанных в пользовательских настройках и 
выводит результат в виде списка

Вывод функции get_stocks():
>[{"stock": "AAPL", "price": 220.91},
  {"stock": "AMZN", "price": 175.4},
  {"stock": "GOOGL", "price": 148.71},
  {"stock": "MSFT", "price": 405.72},
  {"stock": "TSLA", "price": 216.27},]


### Модуль views
#### Функция get_data_for_home_page
Основная функция, принимающую на вход строку с датой и временем в формате YYYY-MM-DD HH:MM:SS
и возвращающую JSON-ответ со следующими данными:
- Приветствие в формате «Доброе утро» / «Добрый день» / «Добрый вечер» / «Доброй ночи» в зависимости от текущего времени.
- По каждой карте: последние 4 цифры карты; общая сумма расходов; кешбэк (1 рубль на каждые 100 рублей).
- Топ-5 транзакций по сумме платежа.
- Курс валют.
- Стоимость акций из S&P500.

Вывод функции:
>{     "greeting": "Доброе утро",
        "cards": [
            {"last_digits": "4556", "total_spent": 2547.1, "cashback": 25.47},
            {"last_digits": "5091", "total_spent": 10133.09, "cashback": 101.33},
            {"last_digits": "7197", "total_spent": 12689.61, "cashback": 126.9},],
        "top_transactions": [
            {"date": "16.12.2021", "amount": -14216.42, "category": "ЖКХ", "description": "ЖКУ Квартира"},
            {"date": "02.12.2021", "amount": -5510.8, "category": "Каршеринг", "description": "Ситидрайв"},
            {"date": "14.12.2021", "amount": -5000.0, "category": "Переводы", "description": "Светлана Т."},
            {"date": "05.12.2021", "amount": 3500.0, "category": "Пополнения", 
             "description": "Внесение наличных через банкомат Тинькофф",},
            {"date": "04.12.2021", "amount": -3499.0, "category": "Электроника и техника", "description": "DNS"},],
        "currency_rates": [{"currency": "USD", "rate": 91.0}, {"currency": "EUR", "rate": 100.52}],
        "stock_prices": [
            {"stock": "AAPL", "price": 220.11},
            {"stock": "AMZN", "price": 179.55},
            {"stock": "GOOGL", "price": 148.66},
            {"stock": "MSFT", "price": 414.2},
            {"stock": "TSLA", "price": 226.17},],
    }


### Модуль services
#### Функция search_transfers_to_individuals:
Функция принимает данные в формате DataFrame и возвращает JSON со всеми транзакциями, которые относятся к переводам
физ. лицам. Категория такой транзакции — Переводы, а в описании есть имя и первая буква фамилии с точкой.
Например: Валерий А., Сергей З.

Вывод функции search_transfers_to_individuals(df):
>'[{"Дата операции":"01.12.2021 01:06:22",'
    '"Номер карты":"*5091",'
    '"Сумма платежа":23.6,"Категория":"Переводы",'
    '"Описание":"Дмитрий Р.","Дата платежа":"01.12.2021"}]'


### Модуль reports
#### Функция spending_by_weekday(transactions: pd.DataFrame, date: Optional[str] = None) -> Iterable:
Функция принимает данные в формате DataFrame и опциональную дату. Возвращает средние траты в каждый из дней недели
за последние три месяца (от переданной даты), если дата не передана, то берется текущая дата.

Вывод функции spending_by_weekday(df_test, "2022-01-21 17:39:33"): 
>'[{"weekdays":"Friday","spending":645.78},' '{"weekdays":"Tuesday","spending":160.89}]'

#### Декоратор write_to_file
Декоратор для функций-отчетов, записывающий в файл результат, который возвращает функция, формирующая отчет.
Декоратор без параметра — записывает данные отчета в файл с названием по умолчанию "reports.json".
Декоратор с параметром — принимает имя файла в качестве параметра.

@write_to_file()
def my_function(x, y):
    return {'x': x, 'y': y}


## Тестирование
Проект покрыт unit-тестами. Для тестирования использовался фреймворк pytest. 
Для их запуска выполните команду:
```
pytest
```

## Логирование
В данном приложение реализовано логирование для всех модулей. Запись логов происходит в папке logs в корне проекта. 
Формат записи лога в файл включает метку времени, название модуля, название функции, уровень серьезности и сообщение,
описывающее событие или ошибку, которые произошли. Лог перезаписываться при каждом запуске приложения.
Пример записи лога:
2024-09-11 23:29:47,299:services.py:search_transfers_to_individuals ERROR: Произошла ошибка 'Категория'
2024-09-12 23:21:26,243:services.py:search_transfers_to_individuals INFO: Выборка транзакций по Категории "Переводы"
